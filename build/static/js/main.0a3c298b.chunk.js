(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{133:function(e,t,n){"use strict";n.r(t);var s=n(2),a=n(26),c=n.n(a),r=n(16),i=(n(35),n(32)),o=(n(49),n(72),n(17)),u=n.n(o),l=n(29),d=(n(94),n(27)),b=Object(d.b)({name:"userID",initialState:{value:""},reducers:{setUserID:function(e,t){e.value=t.payload}}}),m=b.actions.setUserID,j=function(e){return e.userID.value},h=b.reducer,p=Object(d.b)({name:"conversation",initialState:{value:""},reducers:{setConversation:function(e,t){e.value=t.payload}}}),f=p.actions.setConversation,g=function(e){return e.conversation.value},O=p.reducer,v=n(19),x=n(80),k=(n(62),n(4)),N=function(e){var t=e.message,n=t.sender===e.auth.currentUser.uid?"outgoing":"incoming";return Object(k.jsx)(k.Fragment,{children:Object(k.jsx)("div",{className:"".concat(n),children:Object(k.jsx)("div",{className:"bubble",children:t.message})})})},w=function(e){var t=e.firestore,n=e.auth,a=Object(s.useRef)(),c=Object(s.useState)([]),i=Object(r.a)(c,2),o=i[0],d=i[1],b=Object(s.useState)(0),m=Object(r.a)(b,2),h=m[0],p=m[1],f=Object(s.useState)(""),O=Object(r.a)(f,2),w=O[0],D=O[1],S=Object(s.useState)("false"),I=Object(r.a)(S,2),y=I[0],U=I[1],C=Object(v.c)(j),M=Object(v.c)(g);Object(s.useEffect)((function(){if(""!==C){var e=t.collection("users").doc(C).onSnapshot((function(e){d(e.data().conversations)}));return""!==M&&o.forEach((function(e){e.users[1]===M&&(p(o.findIndex((function(e){return e.users[1]===M}))),U(e.blocked))})),function(){return e()}}}),[C,M]);var E=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"false"===o[h].blocked?o[h].blocked="true":o[h].blocked="false",U(o[h].blocked),e.next=4,t.collection("users").doc(C).update({conversations:o});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(l.a)(u.a.mark((function e(s){var c,r,i,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.preventDefault(),c=new Date,r="false","chatappclient"===o[h].users[1]){e.next=12;break}return e.next=6,t.collection("users").doc(o[h].userID[1]).get();case 6:if((i=(i=e.sent).data().conversations).forEach((function(e){e.users[1]===n.currentUser.uid&&(r=e.blocked,i[i.indexOf(e)].messages.push({message:w,sender:n.currentUser.uid,time:c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" @ "+c.getHours()+":"+c.getMinutes()}))})),"true"===r){e.next=12;break}return e.next=12,t.collection("users").doc(o[h].userID[1]).update({conversations:i});case 12:if(o[h].messages.push({message:w,sender:n.currentUser.uid,time:c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" @ "+c.getHours()+":"+c.getMinutes()}),l=n.currentUser,l.uid,l.photoURL,l.displayName,o.blocked){e.next=17;break}return e.next=17,t.collection("users").doc(C).update({conversations:o});case 17:D(""),a.current.scrollIntoView({behavior:"smooth"});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("button",{className:"block",onClick:E,children:"true"===y?"Unblock":"Block"}),Object(k.jsxs)("main",{className:"middle",children:[o[h]&&o[h].messages.map((function(e){return Object(k.jsx)(N,{message:e,auth:n,name:n.currentUser.displayName},Object(x.v4)())})),Object(k.jsx)("span",{ref:a})]}),Object(k.jsx)("div",{className:"bottom-bar",children:Object(k.jsx)("div",{children:Object(k.jsx)("form",{onSubmit:F,children:Object(k.jsxs)("div",{className:"chat",children:[Object(k.jsx)("input",{value:w,onChange:function(e){return D(e.target.value)},placeholder:"Be kind"}),Object(k.jsx)("button",{className:"send_btn",type:"submit",disabled:!w,children:Object(k.jsx)("img",{src:"https://img.icons8.com/color/24/000000/filled-sent.png"})})]})})})})]})},D=n(82),S=Object(d.b)({name:"convoName",initialState:{value:"Chat App"},reducers:{setConvoName:function(e,t){e.value=t.payload}}}),I=S.actions.setConvoName,y=function(e){return e.convoName.value},U=S.reducer,C=n(83),M=function(e){var t=e.auth,n=e.firestore,s=Object(v.b)(),a=n.collection("users"),c=Object(C.a)(a,{idField:"id"}),o=Object(r.a)(c,1)[0],d=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,s,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,s=t.email,c=t.displayName,r=new Date,e.next=4,a.add({uid:n,email:s,username:c,conversations:[{users:[n,"chatappclient"],names:[c,"Chat App"],emails:[s,"chatappclient@example.com"],blocked:"false",messages:[{message:"Welcome to the chat app",sender:"chatappclient",time:r.getDate()+"/"+(r.getMonth()+1)+"/"+r.getFullYear()+" @ "+r.getHours()+":"+r.getMinutes()},{message:"To start a new chat, search for the email of another user",sender:"chatappclient",time:r.getDate()+"/"+(r.getMonth()+1)+"/"+r.getFullYear()+" @ "+r.getHours()+":"+r.getMinutes()}]}]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(k.jsx)(k.Fragment,{children:Object(k.jsx)("button",{className:"sign-in",onClick:function(){var e=!1,n=new i.a.auth.GoogleAuthProvider;t.signInWithPopup(n).then((function(n){o.forEach((function(n){n.uid===t.currentUser.uid&&(Object(D.a)("exists"),e=!0)})),e||d(t.currentUser)})).catch((function(e){console.log(e.message),console.log("You are not logged in!")})),s(I("Chat App"))},children:"Sign in with Google"})})},E=function(e){var t=e.auth;return t.currentUser&&Object(k.jsx)("button",{onClick:function(){return t.signOut()},children:"Sign Out"})},F=n(84),H=n.n(F),A=function(e){var t=e.auth,n=e.firestore,a=Object(s.useState)({}),c=Object(r.a)(a,2),i=c[0],o=c[1],d=Object(s.useState)([]),b=Object(r.a)(d,2),h=b[0],p=b[1],g=Object(s.useState)(""),O=Object(r.a)(g,2),x=O[0],N=O[1],w=Object(v.b)(),D=Object(v.c)(j),S=function(){var e=Object(l.a)(u.a.mark((function e(t){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t!==i.email&&(s=!1,i.conversations.forEach((function(e){e.emails[1]===t&&(s=!0)})),s||h.forEach(function(){var e=Object(l.a)(u.a.mark((function e(s){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.email!==t){e.next=8;break}return a=new Date,i.conversations.push({userID:[i.id,s.id],users:[i.uid,s.uid],names:[i.username,s.username],blocked:"false",emails:[i.email,s.email],messages:[{message:"This is the beginning of your conversation with "+s.username,sender:"chatappclient",time:a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+" @ "+a.getHours()+":"+a.getMinutes()}]}),s.conversations.push({userID:[s.id,i.id],users:[s.uid,i.uid],names:[s.username,i.username],blocked:"false",email:[s.email,i.email],messages:[{message:"This is the beginning of your conversation with "+i.username,sender:"chatappclient",time:a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+" @ "+a.getHours()+":"+a.getMinutes()}]}),e.next=6,n.collection("users").doc(D).update({conversations:i.conversations});case 6:return e.next=8,n.collection("users").doc(s.id).update({conversations:s.conversations});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(s.useEffect)((function(){if(!(h.length>0)){var e=n.collection("users").onSnapshot((function(e){var n=e.docs.map((function(e){return{uid:e.data().uid,username:e.data().username,conversations:e.data().conversations,email:e.data().email,id:e.id}}));p(n),n.forEach((function(e){e.uid===t.currentUser.uid&&(w(m(e.id)),o(e))}))}));return function(){e()}}}),[]),Object(k.jsxs)("div",{className:"messages",children:[Object(k.jsx)(H.a,{className:"search",value:x,onChange:function(e){return N(e)},onRequestSearch:function(){S(x),N("")}}),Object(k.jsx)("ul",{className:"people",children:0!==Object.keys(i).length?i.conversations.map((function(e){return Object(k.jsxs)("li",{className:"person",onClick:function(){w(f(e.users[1])),w(I(e.names[1]))},children:[Object(k.jsx)("span",{className:"title",children:e.names[1]})," ",Object(k.jsx)("br",{}),Object(k.jsxs)("span",{className:"preview",children:[e.messages[e.messages.length-1].message.substring(0,24),"..."]}),Object(k.jsx)("br",{}),Object(k.jsx)("span",{className:"time",children:e.messages[e.messages.length-1].time})," "]},e.users[1])})):Object(k.jsx)("div",{children:"loading..."})})]})},Y=n(85);i.a.initializeApp({apiKey:"AIzaSyBQ4lnhpOV4T1U7IkAHMLagH47sLRKcDuE",authDomain:"chat-app-467eb.firebaseapp.com",projectId:"chat-app-467eb",storageBucket:"chat-app-467eb.appspot.com",messagingSenderId:"184429127568",appId:"1:184429127568:web:86eda818bdce20e72d7515",measurementId:"G-952KS2QW9T"});var B=i.a.auth(),T=i.a.firestore();var R=function(){var e=Object(Y.a)(B),t=Object(r.a)(e,1)[0],n=Object(s.useState)(""),a=Object(r.a)(n,2),c=a[0],i=a[1],o=Object(v.c)(y);return Object(s.useEffect)((function(){i(o)})),Object(k.jsxs)("div",{className:"container",children:[Object(k.jsxs)("header",{className:"top-bar",children:[Object(k.jsx)("h1",{className:"head",children:c}),Object(k.jsx)(E,{auth:B})]}),Object(k.jsx)("section",{className:"",children:t?Object(k.jsx)(w,{auth:B,firestore:T}):Object(k.jsx)(M,{auth:B,firestore:T})}),t?Object(k.jsx)(A,{auth:B,firestore:T}):Object(k.jsx)("div",{})]})},G=Object(d.a)({reducer:{conversation:O,userID:h,convoName:U}});c.a.render(Object(k.jsx)(v.a,{store:G,children:Object(k.jsx)(R,{})}),document.getElementById("root"))},35:function(e,t,n){}},[[133,1,2]]]);
//# sourceMappingURL=main.0a3c298b.chunk.js.map